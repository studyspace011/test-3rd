<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class 12th Self MCQ Test</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&family=Noto+Nastaliq+Urdu:wght@400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📝</text></svg>">
</head>
<body>
    <div id="home-screen" class="screen active">
        <div class="container">
            <h1 id="welcome-message">📝 Class 12th Self MCQ Test</h1>
            
            <div id="name-input-section" class="input-section">
                <input type="text" id="user-name-input" placeholder="Enter Your Name" required>
                <button id="set-name-btn" class="primary-btn wide-btn">Let's Go!</button>
            </div>

            <div id="test-main-section" class="test-main-section hidden">
                <div id="status" class="status">
                    Questions Loaded: <span id="question-count">0</span>
                </div>

                <div id="subject-selection" class="upload-section animated-section">
                    <h3>Select Subject and Chapter</h3>
                    <div class="setting-item">
                        <label for="subject-select">Subject:</label>
                        <select id="subject-select" required>
                            <option value="">-- Select Subject --</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="chapter-select">Chapter:</label>
                        <select id="chapter-select" disabled required>
                            <option value="">-- Select Subject First --</option>
                        </select>
                    </div>
                </div>

                <div id="test-setup" class="test-setup animated-section hidden">
                    <h3>Test Settings</h3>
                    
                    <div class="setting-item">
                        <label for="num-questions">Number of Questions:</label>
                        <input type="number" id="num-questions" min="1" value="10">
                    </div>
                    
                    <div class="setting-item">
                        <label for="total-time-limit">Time Limit (in minutes):</label>
                        <input type="number" id="total-time-limit" min="1" value="30" placeholder="Minutes">
                    </div>
                    
                    <div class="setting-item checkbox-style">
                        <input type="checkbox" id="shuffle-questions" checked>
                        <label for="shuffle-questions">Shuffle Questions</label>
                    </div>
                    
                    <div class="setting-item checkbox-style">
                        <input type="checkbox" id="shuffle-options" checked>
                        <label for="shuffle-options">Shuffle Options</label>
                    </div>
                    
                    <button id="start-test" class="primary-btn wide-btn">🚀 Start Test</button>
                </div>
                
                <div class="navigation-links">
                    <button id="view-history" class="secondary-btn">📚 Test History</button>
                    <button id="view-analytics" class="secondary-btn">📈 View Analytics</button>
                    <button id="install-app-btn" class="success-btn hidden">📲 Install App</button>
                </div>
            </div>
        </div>
    </div>

    <div id="test-screen" class="screen">
        <div class="container">
            <div class="test-header">
                <div class="timer">⏱️ <span id="time-left">00:00</span></div>
                <div class="progress">
                    Question <span id="current-question">1</span> / <span id="total-questions">0</span>
                </div>
            </div>
            
            <div id="question-container" class="question-container">
                <h3 id="question-text"></h3>
                <div id="options-container" class="options-container"></div>
            </div>

            <div class="test-controls">
                <button id="prev-btn" class="secondary-btn">⬅️ Previous</button>
                <button id="next-btn" class="primary-btn">Next ➡️</button>
                <button id="submit-test" class="success-btn hidden">Submit Test</button>
            </div>
        </div>
    </div>

    <div id="results-screen" class="screen">
        <div class="container">
            <h2>📊 Result</h2>
            
            <div class="result-summary">
                <div class="score-card">
                    <h3>Your Marks 💯</h3>
                    <div class="score"><span id="score">0</span>/<span id="total-score">0</span></div>
                    <div class="percentage"><span id="percentage">0</span>%</div>
                </div>
                
                <div class="test-info">
                    <p><strong>Subject:</strong> <span id="result-subject">-</span></p>
                    <p><strong>Chapter:</strong> <span id="result-chapter">-</span></p>
                    <p><strong>Time Taken: ⏱️</strong> <span id="time-taken">00:00</span></p>
                </div>
            </div>

            <div class="detailed-results">
                <h3>Detailed Review 📑</h3>
                <div id="questions-review" class="questions-review"></div>
            </div>

            <div class="result-actions">
                <button id="new-test" class="primary-btn">Start New Test</button>
                <button id="export-results" class="secondary-btn">📥 Download Result</button>
            </div>
        </div>
    </div>

    <div id="history-screen" class="screen">
        <div class="container">
            <h2>📚 Test History</h2>
            <div id="history-list" class="history-list"></div>
            <div class="history-actions">
                <button id="back-to-home" class="secondary-btn">🏠 Back to Home</button>
                <button id="clear-history" class="danger-btn">🗑️ Clear History</button>
            </div>
        </div>
    </div>

    <script>
        // Define the robust renderMath function globally
        window.renderMath = function() {
            // Check if MathJax object exists and has started before rendering
            if (typeof MathJax !== 'undefined' && MathJax.startup.started) {
                // Use the correct MathJax method to process new content
                MathJax.typesetPromise(); 
            } else {
                // Fallback: If not ready, wait and try again
                setTimeout(window.renderMath, 100);
            }
        };
        
        // MathJax Global Configuration: MUST be defined before the main MathJax script loads
        MathJax = {
            tex: {
                // Enable single dollar signs ($) for inline math rendering
                inlineMath: [['$', '$'], ['\\(', '\\)']] 
            },
            startup: {
                // Prevent automatic render on initial page load (we control rendering)
                typeset: false 
            }
        };
    </script>
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    
    <script id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <script src="script.js"></script> 
</body>
</html>
